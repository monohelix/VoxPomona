{% extends 'base.html' %}
{% load staticfiles %}

{% block content %}

<nav class="col-xs-3 menu">
  <div class="user_menu">
    <a href="/profile"><div class="list-group withripple">
      <div class="list-group-item">
        <div class="row-action-primary">
          <i class="material-icons">person</i>
        </div>
        <div class="row-content">
          <h4 class="list-group-item-heading ">{{ user.UserInfo.name }}</h4>
        </div>
      </div>
    </div></a>
    <div class="btn-group-vertical">
      {% if sign_status %}
        <form action="#" method="get">
          <input type="submit" class="btn btn-raised btn-primary" value="Revoke Signature" name="revoke_btn">
        </form>
      {% elif user_perm > 1 %}
        <form action="#" method="get">
          <input type="submit" class="btn btn-raised btn-primary" value="Sign This Petition" name="sign_btn">
        </form>
      {% else %}
        <!-- do nothing -->
      {% endif %}
      {% if is_owner %}
        <form action="#" method="get">
          <input type="submit" class="btn btn-raised btn-danger" value="Delete This Petition" name="delete_btn">
        </form>
      {% endif %}
    </div>
  </div>
  <ul>
    <a href="/home"><li class="withripple" data-target="#about">Go back</li></a>
    <li></li>
    <a href="/logout/"><li class="withripple">Logout</li></a>
  </ul>
</nav>

<div class="pages col-xs-9">
	<div class ="well">
    <h1>{{ petition.title }}</h1>
    <p><em>Started by {{ petition.get_creator_name }}</em></p>
    
    <h2> Introduction </h2>
    <p>{{ petition.summary }}</p>
    <br />
    <p><em>We ask that the College do the following:</em></p>
  </div>
  <br />

  {% for cl in clauses %}
    <div class="well">
      {% if is_owner %}
        <form action="/delete_clause" method="POST" class="pull-right">
          {% csrf_token %}
          <input type="hidden" name="clause_index" value="{{ cl.index }}">
          <input type="hidden" name="petition_id" value="{{ petition.petitionID }}">
          <input type="submit" class="btn btn-danger" value="Delete This Clause">
        </form>
      {% endif %}
      <h1>Clause {{ forloop.counter }}</h1>
      <p class="pet_content">{{ cl.content }}</p>
      {% if cl.has_comments %}
        <hr></hr>
        <h3>Comments</h3>
        {% for c in comments %}
          {% if c.clauseID.clauseID == cl.clauseID %}
            <p><b>{{ c.get_name }}: </b>{{ c.content }}
            {% if c.userID.email == user.UserInfo.email %}
              <form action="/delete_comment" method="POST" class="pull-right">
                {% csrf_token %}
                <input type="hidden" name="comment_id" value="{{ c.commentID }}">
                <input type="hidden" name="petition_id" value="{{ petition.petitionID }}">
                <input type="submit" class="btn btn-danger btn-sm" value="Delete Your Comment">
              </form>
              <br />
            {% endif %}
            </p>
          {% endif %}
        {% endfor %}
      {% endif %}
      {% if user_perm > 2 %}
        <form action="/add_comment" method="POST">
          {% csrf_token %}
          <input type="hidden" name="clause_id" value="{{ cl.clauseID }}">
          <input type="hidden" name="petition_id" value="{{ petition.petitionID }}">
          <div class="form-group label-floating">
            <label class="control-label" for="focusedInput1">Add a comment</label>
            <input class="form-control" name="content" required="required">
            <p class="help-block">Press Enter to save your comment</p>
          </div>
        </form>
      {% endif %}
    </div>
    <br />
  {% endfor %}

  {% if is_owner %}
    <div class="well">
      <h1>Add a new clause</h1>
      <form method="post">
        {% csrf_token %}
        {% for field in new_clause_form %}
          <div class="form-group label-floating">
            {% if field.label %}
              <label class="control-label" for="focusedInput1">{{ field.label }}</label>
            {% endif %}
            {{ field }}
            <p class="help-block">{{ field.help_text }}</p>
          </div>
            {% for error in field.errors %}
              <p style="color: red">{{ error }}</p>
            {% endfor %}
        {% endfor %}
      </form>
    </div>
    <br />
  {% endif %}
  
  <!-- Clauses go here -->
  <div class ="well">
    <h1>Signatures</h1>
    {% for sig in petition.get_signatures %}
      <p>{{sig.get_name}}</p>
    {% endfor %}
  </div>
</div>

{% endblock %}